<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Inclusive Support Hub - タブ版</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="../../theme.css">
<script src="../../settings-common.js" defer></script>

</head>
<body>
  <header class="shell-header">
    <div class="shell-inner">
      <div class="shell-brand">
        <span class="shell-mark"></span>
        <span class="shell-name">Inclusive Support Hub</span>
      </div>

      <nav class="shell-nav" aria-label="メインタブ">
        <button class="shell-tab active" data-tab="isisotuu">意思疎通</button>
        <button class="shell-tab" data-tab="mental">メンタル</button>
        <button class="shell-tab" data-tab="seikatu">生活</button>
        <button class="shell-tab" data-tab="kouryu">交流</button>
        <button class="shell-tab" data-tab="shindan">診断</button>
        <button class="shell-tab" data-tab="iro">色</button>
        <button class="shell-tab" data-tab="settei">設定</button>
      </nav>

      <!-- ヘッダー右側にログアウトボタンだけ置く -->
      <div class="shell-auth">
        <button id="logoutBtn" class="auth-logout">ログアウト</button>
      </div>
    </div>
  </header>
  <!-- ▼ ログインチェック＆ログアウト処理 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabaseClient.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      // ★ここで「自動ログイン」チェック
      const user = await getCurrentUser();
      if (!user) {
        // 未ログインなら即ログイン画面へ
        window.location.href = "login.html";
        return;
      }

      // ログアウトボタン
      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", async () => {
          await logoutAndRedirect("login.html");
        });
      }
    });
  </script>

  <main class="shell-main">
    <div class="shell-frame-wrap">
      <!-- ここにタブの中身を iframe で読み込む -->
      <iframe
        id="tabFrame"
        src="tabs/isisotuu/index.html"
        title="Inclusive Support Tab"
        frameborder="0"
        class="shell-frame"
      ></iframe>
    </div>
  </main>

  <footer class="shell-footer">
    <p>※このページ自体はタブの切り替えだけを担当し、各タブの機能は tabs 以下のミニアプリに分割されています。</p>
  </footer>

  <!-- タブ切り替え本体 -->
  <script src="core.js"></script>
  <script type="module" src="./js/uploadAndDetect.js"></script>

</body>
</html>
