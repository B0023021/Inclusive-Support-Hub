<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ログイン | Inclusive Support Hub</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="theme.css" />
  <!-- Supabase (must be loaded BEFORE supabaseClient.js) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./supabaseClient.js"></script>
</head>
<body class="auth-page">
  <div class="auth-container">
    <h1 class="auth-title">ログイン</h1>

    <div class="auth-card">
      <label class="auth-label" for="email">メールアドレス</label>
      <input id="email" class="auth-input" type="email" autocomplete="email" placeholder="example@mail.com" />

      <label class="auth-label" for="password">パスワード</label>
      <input id="password" class="auth-input" type="password" autocomplete="current-password" placeholder="••••••••" />

      <button id="loginBtn" class="auth-btn">ログイン</button>

      <p id="msg" class="auth-msg" aria-live="polite"></p>

      <div class="auth-footer">
        <a href="./signup.html">新規登録はこちら</a>
      </div>
    </div>
  </div>

  <script>
    // すでにログイン済みなら index に飛ばす
    (async () => {
      try {
        const user = await getCurrentUser();
        if (user) location.href = "./index.html";
      } catch (e) { /* noop */ }
    })();

    const $ = (id) => document.getElementById(id);
    const msg = (t) => { $("msg").textContent = t || ""; };

    $("loginBtn").addEventListener("click", async () => {
      msg("");
      const email = $("email").value.trim();
      const password = $("password").value;

      if (!email || !password) {
        msg("メールとパスワードを入力してください。");
        return;
      }

      const { error } = await sb.auth.signInWithPassword({ email, password });
      if (error) {
        msg("ログイン失敗: " + error.message);
        return;
      }
      location.href = "./index.html";
    });

    // Enterでも送信
    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") $("loginBtn").click();
    });
  </script>


</body>
</html>
