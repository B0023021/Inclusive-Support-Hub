<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>新規登録 | Inclusive Support Hub</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="theme.css" />
  <!-- Supabase (must be loaded BEFORE supabaseClient.js) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./supabaseClient.js"></script>
</head>
<body class="auth-page">
  <div class="auth-container">
    <h1 class="auth-title">新規登録</h1>

    <div class="auth-card">
      <label class="auth-label" for="email">メールアドレス</label>
      <input id="email" class="auth-input" type="email" autocomplete="email" placeholder="example@mail.com" />

      <label class="auth-label" for="password">パスワード</label>
      <input id="password" class="auth-input" type="password" autocomplete="new-password" placeholder="8文字以上推奨" />

      <button id="signupBtn" class="auth-btn">登録する</button>

      <p id="msg" class="auth-msg" aria-live="polite"></p>

      <div class="auth-footer">
        <a href="./login.html">ログインへ戻る</a>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const msg = (t) => { $("msg").textContent = t || ""; };

    $("signupBtn").addEventListener("click", async () => {
      msg("");
      const email = $("email").value.trim();
      const password = $("password").value;

      if (!email || !password) {
        msg("メールとパスワードを入力してください。");
        return;
      }

      // Netlifyでも localhostでも動くように、ここでリダイレクト先を明示
      const emailRedirectTo = location.origin + "/oauth-callback.html";

      const { data, error } = await sb.auth.signUp({
        email,
        password,
        options: { emailRedirectTo }
      });

      if (error) {
        msg("登録失敗: " + error.message);
        return;
      }

      // Supabase設定次第で、メール確認が必要
      msg("登録OK。確認メールを送信しました。メールのリンクを開いて完了してください。");
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") $("signupBtn").click();
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/supabaseClient.js"></script>
<script src="/core.js"></script>

</body>
</html>
